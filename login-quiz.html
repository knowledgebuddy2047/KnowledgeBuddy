<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz with Login</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Login Section -->
  <div id="login-section">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Enter your name">
    <button class="button" onclick="login()">Login</button>
  </div>

  <!-- Quiz Section -->
  <div id="quiz-section" class="hidden">
    <h2 id="quiz-title"></h2>
    <div id="content-body"></div>
  </div>

<script>
function login() {
  const user = document.getElementById("username").value.trim();
  if (!user) return alert("Please enter a name!");
  localStorage.setItem("currentUser", user);

  alert("Logged in as " + user);
  document.getElementById("login-section").classList.add("hidden");
  document.getElementById("quiz-section").classList.remove("hidden");

  // Load quiz after login
  const quizFile = localStorage.getItem("quizFile");
  const subject = localStorage.getItem("selectedSubject");
  const chapter = localStorage.getItem("selectedChapter");

  document.getElementById("quiz-title").textContent = subject + " - " + chapter;
  startQuiz(quizFile);
}

function startQuiz(file) {
  fetch(`data/${file}`)
    .then(res => res.json())
    .then(data => {
      let quizHTML = "<form id='quiz-form'>";
      data.quiz.forEach((q, i) => {
        quizHTML += `<div>
          <p>${i+1}. ${q.question}</p>
          ${q.options.map(opt => 
            `<label>
              <input type="radio" name="q${i}" value="${opt}"> ${opt}
            </label><br>`
          ).join("")}
        </div>`;
      });
      quizHTML += `<button type="button" onclick="submitQuiz('${file}')">Submit Quiz</button></form>`;
      document.getElementById("content-body").innerHTML = quizHTML;
    });
}

// üëâ Use your excellent submitQuiz(file) function here
function submitQuiz(file) {
  fetch(`data/${file}`)
    .then(res => res.json())
    .then(data => {
      let score = 0;
      let resultsHTML = "<h3>Results</h3><ul>";
      
      data.quiz.forEach((q, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        const answer = selected ? selected.value : null;
        const correct = q.answer;
        const explanation = q.explanation || "";

        let statusText;
        if (!answer) {
          statusText = "‚ö†Ô∏è Not attempted";
        } else if (answer === correct) {
          score++;
          statusText = "‚úÖ Correct";
        } else {
          statusText = "‚ùå Incorrect";
        }

        resultsHTML += `<li>
          Q${i+1}: ${q.question}<br>
          Your answer: ${answer ? answer : "No answer"} <br>
          Correct answer: ${correct} <br>
          ${statusText}<br>
          ${explanation ? `<em>Explanation: ${explanation}</em>` : ""}
        </li><br>`;
      });

      resultsHTML += `</ul><p><strong>Final Score: ${score} / ${data.quiz.length}</strong></p>`;

      const percentage = (score / data.quiz.length) * 100;
      if (percentage >= 80) {
        resultsHTML += "<p>üéâ Great job! You‚Äôre mastering this topic.</p>";
      } else if (percentage >= 50) {
        resultsHTML += "<p>üëç Good effort! Keep practicing to improve.</p>";
      } else {
        resultsHTML += "<p>üí° Don‚Äôt worry ‚Äî review the notes and try again!</p>";
      }

      document.getElementById("content-body").innerHTML = resultsHTML;
    });
}
</script>
</body>
</html>
